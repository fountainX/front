import{a as n}from"../axios/axios.3ae77db0.js";import{N as s}from"../nprogress/nprogress.41b0c8a4.js";import{a as p}from"../js-cookie/js-cookie.0390a690.js";import{E as r}from"../element-plus/element-plus.86060dd3.js";const d="token";function l(){return p.get(d)}function f(e){return p.set(d,e)}function F(){return p.remove(d)}n.defaults.baseURL="https://api.ayuan.uk";n.defaults.timeout=1e4;n.defaults.headers={"Content-Type":"application/json;charset=UTF-8",Accept:"application/json, text/plain, */*","X-Requested-With":"XMLHttpRequest","Access-Control-Allow-Origin":"*"};const h={"Content-Type":"application/json;charset=UTF-8",Accept:"application/json, text/plain, */*","X-Requested-With":"XMLHttpRequest","Access-Control-Allow-Origin":"*"};n.interceptors.request.use(e=>(e.headers={...h,...e.headers},l()&&(e.headers.Authorization="Bearer "+l()),e),e=>e);n.interceptors.response.use(e=>{if((e.headers||{}).isToken,e.method==="get"&&e.params){let o=e.url+"?";for(const u of Object.keys(e.params)){const a=e.params[u];var t=encodeURIComponent(u)+"=";if(a!==null&&typeof a!="undefined")if(typeof a=="object")for(const i of Object.keys(a)){const m=u+"["+i+"]";var c=encodeURIComponent(m)+"=";o+=c+encodeURIComponent(a[i])+"&"}else o+=t+encodeURIComponent(a)+"&"}o=o.slice(0,-1),e.params={},e.url=o}return e},e=>{if(e&&e.response)switch(e.response.status){case 400:console.log("\u8BF7\u6C42\u9519\u8BEF");break;case 401:r.error("\u672A\u6388\u6743\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55");break;case 403:r.error("\u62D2\u7EDD\u8BBF\u95EE");break;case 404:console.log("\u8BF7\u6C42\u9519\u8BEF,\u672A\u627E\u5230\u8BE5\u8D44\u6E90");break;case 405:r.error("\u8BF7\u6C42\u65B9\u6CD5\u672A\u5141\u8BB8");break;case 408:r.error("\u8BF7\u6C42\u8D85\u65F6");break;case 422:r.error("token\u5931\u6548\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55\uFF01"),localStorage.removeItem("userInfo"),F(),localStorage.clear(),window.location.href="#/login",setTimeout(()=>{location.reload()},200);break;case 408:r.error("\u8BF7\u6C42\u8D85\u65F6");break;case 500:console.log("\u670D\u52A1\u5668\u7AEF\u51FA\u9519");break;case 501:r.error("\u7F51\u7EDC\u672A\u5B9E\u73B0");break;case 502:r.error("\u7F51\u7EDC\u9519\u8BEF");break;case 503:r.error("\u670D\u52A1\u4E0D\u53EF\u7528");break;case 504:r.error("\u7F51\u7EDC\u8D85\u65F6");break;case 505:r.error("http\u7248\u672C\u4E0D\u652F\u6301\u8BE5\u8BF7\u6C42");break;default:r.error(`\u8FDE\u63A5\u9519\u8BEF${e.response.status}`)}else console.log("\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25");return Promise.resolve(e.response)});const b={get(e,t){return new Promise((c,o)=>{s.start(),n.get(e,{params:t}).then(u=>{s.done(),c(u.data)}).catch(u=>{s.done(),o(u.data)})})},post(e,t,c){return new Promise((o,u)=>{s.start(),n.post(e,JSON.stringify(t),{headers:c}).then(a=>{s.done(),o(a.data)}).catch(a=>{s.done(),u(a.data)})})},upload(e,t){return new Promise((c,o)=>{s.start(),n.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then(u=>{s.done(),c(u.data)}).catch(u=>{s.done(),o(u.data)})})},download(e){const t=document.createElement("iframe");t.style.display="none",t.src=e,t.onload=function(){document.body.removeChild(t)},document.body.appendChild(t)},async downloadBlob(e){return fetch(n.defaults.baseURL+e,{method:"post",headers:{Authorization:"Bearer "+l()}})}};export{b as H,F as r,f as s};
